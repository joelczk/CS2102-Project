CREATE TABLE Users (
	id		INTEGER PRIMARY KEY,
	name		VARCHAR(100) NOT NULL,
	account_id	VARCHAR(10) NOT NULL UNIQUE,
	image_file	VARCHAR(100) NOT NULL DEFAULT 'default.jpg'
	password	VARCHAR(20) NOT NULL
);

CREATE TABLE Roles (
	id		INTEGER PRIMARY KEY,
	name		VARCHAR(50) NOT NULL UNIQUE
);

CREATE TABLE UserRoles (
	id		INTEGER PRIMARY KEY,
	user_id		INTEGER NOT NULL REFERENCES Users(id),
	role_id		INTEGER NOT NULL REFERENCES Roles(id)
);



CREATE TABLE Students (
	sid	 	INTEGER PRIMARY KEY REFERENCES Users(id),
	year 		INTEGER NOT NULL CHECK (year >= 1 AND year <= 5),
);

CREATE TABLE Courses (
	cid	 	VARCHAR(10) PRIMARY KEY,
	cname 		VARCHAR(100) NOT NULL UNIQUE
);

CREATE TABLE TakenCourses (
	sid 	 	INTEGER REFERENCES Students,
	cid	 	VARCHAR(10) REFERENCES Courses,
	year 		INTEGER NOT NULL,
	sem	 	INTEGER NOT NULL CHECK (sem = 1 OR sem = 2),
	grade 		VARCHAR(5) NOT NULL,
	PRIMARY KEY (sid, cid)
);

CREATE TABLE TakingCourses (
	sid	 	INTEGER REFERENCES Students,
	cid	 	VARCHAR(10) REFERENCES Courses,
	PRIMARY KEY (sid, cid)
);

CREATE TABLE Professors (
	pid	 	INTEGER PRIMARY KEY,
	cid	 	VARCHAR(10) NOT NULL UNIQUE REFERENCES Courses,
);

CREATE TABLE PossibleTA (
	sid	 	INTEGER,
	cid	 	VARCHAR(10),
	FOREIGN KEY (sid, cid) REFERENCES TakenCourses (sid, cid),
	PRIMARY KEY (sid, cid)
);

CREATE TABLE TeachingAssistants (
	sid	 	INTEGER PRIMARY KEY,
	cid	 	VARCHAR(10) NOT NULL,
	FOREIGN KEY (sid, cid) REFERENCES PossibleTA (sid, cid)
);

CREATE TABLE Groups (
	gid	 	INTEGER PRIMARY KEY,
	gname 		VARCHAR(50) NOT NULL,
	cid	 	VARCHAR(10) NOT NULL REFERENCES Professors,
	sid	 	INTEGER REFERENCES TeachingAssistants,
);

CREATE TABLE GroupInfo (
	gid	 	INTEGER REFERENCES Groups ON DELETE CASCADE,
	sid	 	INTEGER REFERENCES Students,
	PRIMARY KEY (gid, sid)
);

CREATE TABLE Forums (
	fid	 	INTEGER PRIMARY KEY,
	title 		VARCHAR(100) NOT NULL,
	pid	 	INTEGER NOT NULL REFERENCES Professors
	date_created 	DATE NOT NULL
);

CREATE TABLE ForumInfo (
	fid	 	INTEGER REFERENCES Forums,
	gid 		INTEGER REFERENCES Groups,
	PRIMARY KEY (fid, gid)
);

CREATE TABLE Posts (
	post_num 	INTEGER,
	fid	 	INTEGER REFERENCES Forums ON DELETE CASCADE,
	sid	 	INTEGER NOT NULL REFERENCES Students,
	pid 		INTEGER REFERENCES Professors,
	title 		VARCHAR(100) NOT NULL,
	content	 	TEXT NOT NULL,
	date_posted 	DATE NOT NULL,
	rating 		INTEGER DEFAULT NULL CHECK (rating IS NULL OR (rating >= 0 AND rating <= 5)),
	PRIMARY KEY (fid, post_num)
);
